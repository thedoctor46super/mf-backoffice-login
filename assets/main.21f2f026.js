import{a as e,b as o,v as t,u as n,G as a}from"./vendor.3b9053f4.js";var s=(e,o)=>{for(const[t,n]of o)e[t]=n;return e};const l={id:"app"};var r=s({name:"App"},[["render",function(e,o,t,n,a,s){const r=vue.resolveComponent("router-view");return vue.openBlock(),vue.createElementBlock("div",l,[vue.createVNode(r)])}]]);const i=(o,t,n)=>{const a=60*(n?525600:480)*1e3,s=window.location.protocol.includes("https"),l=new Date;l.setTime(l.getTime()+a),e.set(o,t,{path:"/",domain:document.domain,expires:l,secure:s})},c=e.get;e.remove;const u=e=>{(e=>{i("ft-portaltoken",e,!0)})(e.AuthToken),e.Permissions=e.Permissions||[],i("ft-user",JSON.stringify({UserId:e.UserId,Username:e.Username,AuthToken:e.AuthToken,Permissions:e.Permissions.filter((e=>e.toLowerCase().includes("serviceportal")))}),!0)};const d={name:"Login",components:{vueRecaptcha:t},data:()=>({loading:!1,showGoogleLogin:!1,loginError:!1,username:"",password:"",showGoogleOnly:!1}),watch:{loginError(e){e&&setTimeout((()=>{this.loginError=!1}),3e3)},showGoogleLogin(e){i("ft-spf-google-login",e,!0)}},async mounted(){this.showGoogleOnly=await(async()=>!1)(),this.showGoogleLogin="true"===c("ft-spf-google-login")||this.showGoogleOnly},methods:{async triggerGoogleLogin(){const e=await this.$gAuth.signIn();if(!e)return null;this.toggleLoading(!0),this.performGoogleLogin(e)},async performGoogleLogin(e){const t=await async function(e){return o.post("https://patrik-staging.ft-crm.com/crm-api/Authentication/GoogleLogin",{gToken:e})}(e.getAuthResponse().id_token);this.loginError=!t.data.Success,t.data.Success&&this.loginSuccess(t.data.Data)},async loginSuccess(e){u(e),this.$router.push({path:"/"})},async onSubmit(){this.username.trim()&&this.password.trim()?grecaptcha.execute():this.loginError=!0},recaptchaVerified(e){try{const t=e;(async function({username:e,password:t,recaptchaToken:n}){return o.post("https://patrik-staging.ft-crm.com/prisma-api/Authentication/LoginAdminCaptcha",{Username:e,Password:t,RecaptchaToken:n})})({username:this.username,password:this.password,recaptchaToken:t}).then((e=>{this.loginError=!e.data.Success,e.data.Success&&this.loginSuccess(e.data.Data),this.$refs.vueRecaptcha.reset()}))}catch(t){console.error("Login error: ",t)}},recaptchaError(e){console.error("Error with recaptcha:",e)},recaptchaExpired(){console.log("Recaptcha expired")},toggleLoading(e){this.loading=e}}},g=e=>(vue.pushScopeId("data-v-6550fa98"),e=e(),vue.popScopeId(),e),p={class:"login flex center"},m={key:0,class:"login-error flex center"},v=[g((()=>vue.createElementVNode("img",{src:"/assets/img/warning.svg",alt:""},null,-1))),vue.createTextVNode(" Â  "),g((()=>vue.createElementVNode("span",null,"Login failed. Please try again.",-1)))],h=g((()=>vue.createElementVNode("span",{class:"login-title"},[vue.createTextVNode("Sign in to "),vue.createElementVNode("span",{class:"ft"},"ft"),vue.createTextVNode(" crm")],-1))),f={key:0},E={key:0,class:"loading"},w=[g((()=>vue.createElementVNode("div",{class:"ball"},null,-1))),g((()=>vue.createElementVNode("div",{class:"ball"},null,-1))),g((()=>vue.createElementVNode("div",{class:"ball"},null,-1))),g((()=>vue.createElementVNode("div",{class:"ball"},null,-1)))],V={key:1,class:"flex center"},k=[g((()=>vue.createElementVNode("img",{src:"/assets/img/google.svg",class:"g-logo",alt:""},null,-1))),g((()=>vue.createElementVNode("span",null,"Sign In",-1)))],N={key:0},y={class:"floating-label"},L=g((()=>vue.createElementVNode("span",{class:"highlight"},null,-1))),b=g((()=>vue.createElementVNode("label",{id:"emailLabel"},"Enter your email",-1))),G=g((()=>vue.createElementVNode("span",{class:"focus-border"},null,-1))),S={class:"floating-label"},x=g((()=>vue.createElementVNode("span",{class:"highlight"},null,-1))),B=g((()=>vue.createElementVNode("label",{id:"passwordLabel"},"Enter your password",-1))),T=g((()=>vue.createElementVNode("span",{class:"focus-border"},null,-1))),A=g((()=>vue.createElementVNode("button",{id:"normalLoginButton",type:"submit",class:"login-btn flex center"}," Sign In ",-1)));const C=[{path:"/login",name:"Login",component:s(d,[["render",function(e,o,t,n,a,s){const l=vue.resolveComponent("vue-recaptcha");return vue.openBlock(),vue.createElementBlock("div",p,[vue.createVNode(vue.Transition,null,{default:vue.withCtx((()=>[a.loginError?(vue.openBlock(),vue.createElementBlock("div",m,v)):vue.createCommentVNode("",!0)])),_:1}),h,vue.createElementVNode("div",{class:vue.normalizeClass(["login-container",{short:a.showGoogleLogin}])},[vue.createVNode(vue.Transition,null,{default:vue.withCtx((()=>[a.showGoogleLogin?(vue.openBlock(),vue.createElementBlock("div",f,[vue.createElementVNode("button",{ref:"ftGoogleSignInButton",class:"login-btn flex center",onClick:o[0]||(o[0]=(...e)=>s.triggerGoogleLogin&&s.triggerGoogleLogin(...e))},[a.loading?(vue.openBlock(),vue.createElementBlock("div",E,w)):(vue.openBlock(),vue.createElementBlock("div",V,k))],512)])):vue.createCommentVNode("",!0)])),_:1}),vue.createVNode(vue.Transition,null,{default:vue.withCtx((()=>[a.showGoogleLogin?vue.createCommentVNode("",!0):(vue.openBlock(),vue.createElementBlock("div",N,[vue.createElementVNode("form",{onSubmit:o[3]||(o[3]=vue.withModifiers(((...e)=>s.onSubmit&&s.onSubmit(...e)),["prevent"]))},[a.showGoogleLogin?vue.createCommentVNode("",!0):(vue.openBlock(),vue.createBlock(l,{key:0,ref:"vueRecaptcha","site-key":"6Lf29EQUAAAAALFiD7lhOASZ5cM3mb8mbGpKYKss",size:"invisible",onVerify:s.recaptchaVerified,onExpire:s.recaptchaExpired,onFail:s.recaptchaError},null,8,["onVerify","onExpire","onFail"])),vue.createElementVNode("fieldset",null,[vue.createElementVNode("div",y,[vue.withDirectives(vue.createElementVNode("input",{id:"username","onUpdate:modelValue":o[1]||(o[1]=e=>a.username=e),class:"floating-input",name:"username",type:"text",placeholder:" "},null,512),[[vue.vModelText,a.username]]),L,b,G]),vue.createElementVNode("div",S,[vue.withDirectives(vue.createElementVNode("input",{id:"password","onUpdate:modelValue":o[2]||(o[2]=e=>a.password=e),class:"floating-input",name:"password",type:"password",autocomplete:"on",placeholder:" "},null,512),[[vue.vModelText,a.password]]),x,B,T]),A])],32)]))])),_:1})],2),a.showGoogleOnly?vue.createCommentVNode("",!0):(vue.openBlock(),vue.createElementBlock("p",{key:0,class:vue.normalizeClass(["login-switcher",{padded:!a.showGoogleLogin}])},[vue.createElementVNode("button",{onClick:o[4]||(o[4]=e=>a.showGoogleLogin=!a.showGoogleLogin)},vue.toDisplayString(a.showGoogleLogin?"Login with Username / Password":"Login with Google"),1)],2))])}],["__scopeId","data-v-6550fa98"]])}],I=vue-I.createRouter({history:vue-I.createWebHistory(),routes:C});n({createApp:vue.createApp,appOptions:{render(){return vue.h(r,{props:{name:this.name,mountParcel:this.mountParcel,singleSpa:this.singleSpa}})}},handleInstance:e=>{e.use(I),e.use(a,{clientId:"706365197587-enedvlgphegpc7sb5c401f4lsmbip4po.apps.googleusercontent.com"})}});
