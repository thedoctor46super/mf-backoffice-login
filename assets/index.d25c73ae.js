import{r as e,c as o,a as s,o as n,b as t,d as a,v as i,w as r,T as l,e as c,n as g,t as u,f as p,p as d,g as h,h as m,i as f,j as w,k as y,l as L,m as v,q as b,u as G,s as k,x as S,G as E}from"./vendor.5feb5f1d.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&o(e)})).observe(document,{childList:!0,subtree:!0})}function o(e){if(e.ep)return;e.ep=!0;const o=function(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?o.credentials="include":"anonymous"===e.crossorigin?o.credentials="omit":o.credentials="same-origin",o}(e);fetch(e.href,o)}}();var A=(e,o)=>{for(const[s,n]of o)e[s]=n;return e};const x={id:"app"};var T=A({name:"App"},[["render",function(t,a,i,r,l,c){const g=e("router-view");return n(),o("div",x,[s(g)])}]]);const I=(e,o,s)=>{const n=60*(s?525600:480)*1e3,a=window.location.protocol.includes("https"),i=new Date;i.setTime(i.getTime()+n),t.set(e,o,{path:"/",domain:document.domain,expires:i,secure:a})},P=t.get;t.remove;const U=e=>{(e=>{I("ft-portaltoken",e,!0)})(e.AuthToken),e.Permissions=e.Permissions||[],I("ft-user",JSON.stringify({UserId:e.UserId,Username:e.Username,AuthToken:e.AuthToken,Permissions:e.Permissions.filter((e=>e.toLowerCase().includes("serviceportal")))}),!0)};const O={name:"Login",components:{vueRecaptcha:i},data:()=>({loading:!1,showGoogleLogin:!1,loginError:!1,username:"",password:"",showGoogleOnly:!1}),watch:{loginError(e){e&&setTimeout((()=>{this.loginError=!1}),3e3)},showGoogleLogin(e){I("ft-spf-google-login",e,!0)}},async mounted(){this.showGoogleOnly=await(async()=>!1)(),this.showGoogleLogin="true"===P("ft-spf-google-login")||this.showGoogleOnly},methods:{async triggerGoogleLogin(){const e=await this.$gAuth.signIn();if(!e)return null;this.toggleLoading(!0),this.performGoogleLogin(e)},async performGoogleLogin(e){const o=await async function(e){return a.post("https://patrik-staging.ft-crm.com/crm-api/Authentication/GoogleLogin",{gToken:e})}(e.getAuthResponse().id_token);this.loginError=!o.data.Success,o.data.Success&&this.loginSuccess(o.data.Data)},async loginSuccess(e){U(e),this.$router.push({path:"/"})},async onSubmit(){this.username.trim()&&this.password.trim()?grecaptcha.execute():this.loginError=!0},recaptchaVerified(e){try{const o=e;(async function({username:e,password:o,recaptchaToken:s}){return a.post("https://patrik-staging.ft-crm.com/prisma-api/Authentication/LoginAdminCaptcha",{Username:e,Password:o,RecaptchaToken:s})})({username:this.username,password:this.password,recaptchaToken:o}).then((e=>{this.loginError=!e.data.Success,e.data.Success&&this.loginSuccess(e.data.Data),this.$refs.vueRecaptcha.reset()}))}catch(o){console.error("Login error: ",o)}},recaptchaError(e){console.error("Error with recaptcha:",e)},recaptchaExpired(){console.log("Recaptcha expired")},toggleLoading(e){this.loading=e}}},R=e=>(d("data-v-6550fa98"),e=e(),h(),e),V={class:"login flex center"},_={key:0,class:"login-error flex center"},C=[R((()=>c("img",{src:"/assets/img/warning.svg",alt:""},null,-1))),L(" Â  "),R((()=>c("span",null,"Login failed. Please try again.",-1)))],D=R((()=>c("span",{class:"login-title"},[L("Sign in to "),c("span",{class:"ft"},"ft"),L(" crm")],-1))),N={key:0},F={key:0,class:"loading"},K=[R((()=>c("div",{class:"ball"},null,-1))),R((()=>c("div",{class:"ball"},null,-1))),R((()=>c("div",{class:"ball"},null,-1))),R((()=>c("div",{class:"ball"},null,-1)))],$={key:1,class:"flex center"},j=[R((()=>c("img",{src:"/assets/img/google.svg",class:"g-logo",alt:""},null,-1))),R((()=>c("span",null,"Sign In",-1)))],q={key:0},B={class:"floating-label"},M=R((()=>c("span",{class:"highlight"},null,-1))),z=R((()=>c("label",{id:"emailLabel"},"Enter your email",-1))),J=R((()=>c("span",{class:"focus-border"},null,-1))),Q={class:"floating-label"},Y=R((()=>c("span",{class:"highlight"},null,-1))),Z=R((()=>c("label",{id:"passwordLabel"},"Enter your password",-1))),H=R((()=>c("span",{class:"focus-border"},null,-1))),W=R((()=>c("button",{id:"normalLoginButton",type:"submit",class:"login-btn flex center"}," Sign In ",-1)));const X=[{path:"/login",name:"Login",component:A(O,[["render",function(t,a,i,d,h,L){const v=e("vue-recaptcha");return n(),o("div",V,[s(l,null,{default:r((()=>[h.loginError?(n(),o("div",_,C)):p("",!0)])),_:1}),D,c("div",{class:g(["login-container",{short:h.showGoogleLogin}])},[s(l,null,{default:r((()=>[h.showGoogleLogin?(n(),o("div",N,[c("button",{ref:"ftGoogleSignInButton",class:"login-btn flex center",onClick:a[0]||(a[0]=(...e)=>L.triggerGoogleLogin&&L.triggerGoogleLogin(...e))},[h.loading?(n(),o("div",F,K)):(n(),o("div",$,j))],512)])):p("",!0)])),_:1}),s(l,null,{default:r((()=>[h.showGoogleLogin?p("",!0):(n(),o("div",q,[c("form",{onSubmit:a[3]||(a[3]=m(((...e)=>L.onSubmit&&L.onSubmit(...e)),["prevent"]))},[h.showGoogleLogin?p("",!0):(n(),f(v,{key:0,ref:"vueRecaptcha","site-key":"6Lf29EQUAAAAALFiD7lhOASZ5cM3mb8mbGpKYKss",size:"invisible",onVerify:L.recaptchaVerified,onExpire:L.recaptchaExpired,onFail:L.recaptchaError},null,8,["onVerify","onExpire","onFail"])),c("fieldset",null,[c("div",B,[w(c("input",{id:"username","onUpdate:modelValue":a[1]||(a[1]=e=>h.username=e),class:"floating-input",name:"username",type:"text",placeholder:" "},null,512),[[y,h.username]]),M,z,J]),c("div",Q,[w(c("input",{id:"password","onUpdate:modelValue":a[2]||(a[2]=e=>h.password=e),class:"floating-input",name:"password",type:"password",autocomplete:"on",placeholder:" "},null,512),[[y,h.password]]),Y,Z,H]),W])],32)]))])),_:1})],2),h.showGoogleOnly?p("",!0):(n(),o("p",{key:0,class:g(["login-switcher",{padded:!h.showGoogleLogin}])},[c("button",{onClick:a[4]||(a[4]=e=>h.showGoogleLogin=!h.showGoogleLogin)},u(h.showGoogleLogin?"Login with Username / Password":"Login with Google"),1)],2))])}],["__scopeId","data-v-6550fa98"]])}],ee=v({history:b(),routes:X});G({createApp:k,appOptions:{render(){return S(T,{props:{name:this.name,mountParcel:this.mountParcel,singleSpa:this.singleSpa}})}},handleInstance:e=>{e.use(ee),e.use(E,{clientId:"706365197587-enedvlgphegpc7sb5c401f4lsmbip4po.apps.googleusercontent.com"})}});
